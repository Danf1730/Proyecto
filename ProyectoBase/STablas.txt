					*LOGIN*

create table login(
    id_login int NOT NULL AUTO_INCREMENT,
    usuario varchar(30) NOT NULL,
    clave varchar(30) NOT NULL ,
    id_empleado int,
    id_cliente int,
    pregunta_1 varchar(50) NOT NULL,
    respuesta_1 varchar(50) NOT NULL,
    pregunta_2 varchar(50) NOT NULL,
    respuesta_2 varchar(50) NOT NULL,
    pregunta_3 varchar(50) NOT NULL,
    respuesta_3 varchar(50) NOT NULL,
    PRIMARY KEY (id_login),    
    FOREIGN KEY (id_empleado) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_cliente) REFERENCES cliente (id_cliente) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_empleado) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_cliente) REFERENCES cliente (id_cliente) ON DELETE CASCADE ON UPDATE CASCADE 
)

ALTER TABLE login ADD CONSTRAINT UQ_ID_EMPLEADO_LOGIN UNIQUE (id_empleado);
ALTER TABLE login ADD CONSTRAINT UQ_USUARIO_LOGIN UNIQUE (usuario);
ALTER TABLE login ADD CONSTRAINT NN_CLAVE_LOGIN CHECK (clave not like '%-%');





				      *SUCURSAL*

create table sucursal(
    id_sucursal int NOT NULL AUTO_INCREMENT,
    ubicacion varchar(50) NOT NULL,
    nombre varchar(50) NOT NULL,
    id_director int NOT NULL,
    PRIMARY KEY (id_sucursal)
)


ALTER TABLE sucursal ADD CONSTRAINT NN_NOMBRE_SUCURSAL CHECK (nombre<>' ');




				      *EMPLEADO*

create table empleado(
    id_empleado int NOT NULL AUTO_INCREMENT,
    id_sucursal int NOT NULL,
    cedula int NOT NULL,  
    nombre varchar(50) NOT NULL, 
    apellido varchar(50) NOT NULL,
    telefono int NOT NULL, 
    direccion varchar(50) NOT NULL,
    fecha_inicio_empresa DATE NOT NULL,
    fecha_inicio_sucursal DATE NOT NULL,
    b_salarial double NOT NULL,
    s_objetivos double NOT NULL,
    tipo_empleado varchar(50) NOT NULL,
    PRIMARY KEY (id_empleado)
    FOREIGN KEY (id_sucursal) REFERENCES sucursal (id_sucursal) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE empleado ADD CONSTRAINT UQ_ID_EMPLEADO_EMPLEADO UNIQUE (id_empleado);
ALTER TABLE empleado ADD CONSTRAINT UQ_ID_CEDULA_EMPLEADO UNIQUE (cedula);
ALTER TABLE empleado ADD CONSTRAINT VN_CEDULA_EMPLEADO CHECK (cedula>0);
ALTER TABLE empleado ADD CONSTRAINT VN_TELEFONO_EMPLEADO CHECK (telefono>0);
ALTER TABLE empleado ADD CONSTRAINT VN_BSALARIAL_EMPLEADO CHECK (b_salarial>0);
ALTER TABLE empleado ADD CONSTRAINT VN_SOBJETIVOS_EMPLEADO CHECK (s_objetivos>0);
ALTER TABLE empleado ADD CONSTRAINT AD_TIPOE_EMPLEADO CHECK (tipo_empleado='Agente' or tipo_empleado='Director');
ALTER TABLE empleado ADD CONSTRAINT NN_NOMBRE_EMPLEADO CHECK (nombre<>' ');
ALTER TABLE empleado ADD CONSTRAINT NN_APELLIDO_EMPLEADO CHECK (apellido<>' ');





				     *SUBORDINADO*

create table subordinado(
    id_subordinado int NOT NULL AUTO_INCREMENT,
    id_empleado int NOT NULL,
    id_empleado_subordinado int,  
    nombre varchar(50) NOT NULL,
    PRIMARY KEY (id_subordinado)
    FOREIGN KEY (id_empleado_subordinado) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE
    FOREIGN KEY (id_empleado) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE
    FOREIGN KEY (id_empleado_subordinado) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE subordinado ADD CONSTRAINT UQ_ID_SUBORDINADO_SUBORDINADO UNIQUE (id_subordinado);
ALTER TABLE subordinado ADD CONSTRAINT NN_NOMBRE_SUBORDINADO CHECK (nombre<>' ');




				     *CARTERA_AGENTE*

create table cartera_agente(
    id_cartera int NOT NULL AUTO_INCREMENT,
    id_empleado int NOT NULL,
    id_poliza int NOT NULL,
    monto int NOT NULL, 
    year int NOT NULL,  
    PRIMARY KEY (id_cartera),
    FOREIGN KEY (id_empleado) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_poliza) REFERENCES poliza (id_poliza) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE cartera_agente ADD CONSTRAINT UQ_ID_CARTERA_CARTAGENTE UNIQUE (id_cartera);
ALTER TABLE cartera_agente ADD CONSTRAINT VN_MONTO_CARTAGENTE CHECK (monto>0);
ALTER TABLE cartera_agente ADD CONSTRAINT VN_YEAR_CARTAGENTE CHECK (year>0);





				        *CLIENTE*

create table cliente(
    id_cliente int NOT NULL AUTO_INCREMENT,
    id_sucursal int NOT NULL,
    id_agente_prestamo int NOT NULL,
    id_asesor_personal int NOT NULL,
    nombre varchar(50) NOT NULL,
    apellido varchar(50) NOT NULL,
    calle varchar(50) NOT NULL,
    ciudad varchar(50) NOT NULL,
    genero varchar(50) NOT NULL,
    fecha_nacimiento DATE NOT NULL,
    telefono int NOT NULL,
    cedula int NOT NULL, 
    profesion varchar(50) NOT NULL, 
    PRIMARY KEY (id_cliente),
    FOREIGN KEY (id_sucursal) REFERENCES sucursal (id_sucursal) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_agente_prestamo) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_asesor_personal) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE cliente ADD CONSTRAINT UQ_ID_CLIENTE_CLIENTE UNIQUE (id_cliente);
ALTER TABLE cliente ADD CONSTRAINT UQ_CEDULA_CLIENTE UNIQUE (cedula);
ALTER TABLE cliente ADD CONSTRAINT G_GENERO_EMPLEADO CHECK (genero='F' or genero='M' or genero='N/A');
ALTER TABLE cliente ADD CONSTRAINT VN_FNACIMIENTO_CLIENTE CHECK (fecha_nacimiento>0);
ALTER TABLE cliente ADD CONSTRAINT VN_TELEFONO_CLIENTE CHECK (telefono>0);
ALTER TABLE cliente ADD CONSTRAINT VN_CEDULA_CLIENTE CHECK (cedula>0);
ALTER TABLE cliente ADD CONSTRAINT NN_NOMBRE_CLIENTE CHECK (nombre<>' ');
ALTER TABLE cliente ADD CONSTRAINT NN_APELLIDO_CLIENTE CHECK (apellido<>' ');





				        *PRESTAMO*

create table prestamo(
    id_prestamo int NOT NULL AUTO_INCREMENT,
    id_empleado int NOT NULL,
    id_sucursal int NOT NULL,
    interes double NOT NULL, 
    importe double NOT NULL,
    PRIMARY KEY (id_prestamo),
    FOREIGN KEY (id_empleado) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_sucursal) REFERENCES sucursal (id_sucursal) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE prestamo ADD CONSTRAINT UQ_ID_PRESTAMO_PRESTAMO UNIQUE (id_prestamo);
ALTER TABLE prestamo ADD CONSTRAINT VN_INTERES_PRESTAMO CHECK (interes>0);
ALTER TABLE prestamo ADD CONSTRAINT VN_IMPORTE_PRESTAMO CHECK (importe>0);




				  *SOLICITANTE_PRESTAMO*

create table solicitante_prestamo(
    id_solicitante int NOT NULL AUTO_INCREMENT,
    id_prestamo int NOT NULL,
    id_cliente int NOT NULL,
    PRIMARY KEY (id_solicitante),
    FOREIGN KEY (id_prestamo) REFERENCES prestamo (id_prestamo) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_cliente) REFERENCES cliente (id_cliente) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE solicitante_prestamo ADD CONSTRAINT UQ_ID_SOLICITANTE_SPRESTAMO UNIQUE (id_solicitante);




				     *MOVIMIENTO_PAGO*

create table movimiento_pago(
    id_movimiento int NOT NULL AUTO_INCREMENT,
    id_prestamo int NOT NULL,
    monto_abono double NOT NULL,
    monto_pendiente double NOT NULL,
    f_pago datetime NOT NULL,
    f_pago_prox date NOT NULL,
    PRIMARY KEY (id_movimiento),
    FOREIGN KEY (id_prestamo) REFERENCES prestamo (id_prestamo) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE movimiento_pago ADD CONSTRAINT UQ_ID_MOVIMIENTO_MOVP UNIQUE (id_movimiento);
ALTER TABLE movimiento_pago ADD CONSTRAINT VN_MABONO_MOVP CHECK (monto_abono>0);
ALTER TABLE movimiento_pago ADD CONSTRAINT VN_MONTOP_MOVP CHECK (monto_pendiente>0);
ALTER TABLE movimiento_pago ADD CONSTRAINT VN_FPAGO_MOVP CHECK (f_pago>0);
ALTER TABLE movimiento_pago ADD CONSTRAINT VN_FPAGO_APROX_MOVP CHECK (f_pago_prox>0);




				        *VEHICULO*

create table vehiculo(
    id_vehiculo int NOT NULL AUTO_INCREMENT,
    id_cliente int NOT NULL,
    matricula varchar(50) NOT NULL,
    marca varchar(50) NOT NULL,
    modelo varchar(50) NOT NULL,
    PRIMARY KEY (id_vehiculo),
    FOREIGN KEY (id_cliente) REFERENCES cliente (id_cliente) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE vehiculo ADD CONSTRAINT UQ_ID_VEHICULO_VEHICULO UNIQUE (id_vehiculo);
ALTER TABLE vehiculo ADD CONSTRAINT UQ_MATRICULA_VEHICULO UNIQUE (matricula);
ALTER TABLE vehiculo ADD CONSTRAINT VN_MATRICULA_VEHICULO CHECK (matricula>0);




				  *VEHICULO_ACCIDENTE*

create table vehiculo_accidente(
    id_accidente int NOT NULL AUTO_INCREMENT,
    lugar varchar(50) NOT NULL,
    f_accidente datetime NOT NULL,
    PRIMARY KEY (id_accidente)
)

ALTER TABLE vehiculo_accidente ADD CONSTRAINT UQ_ID_ACCIDENTE_VACCIDENTE UNIQUE (id_accidente);
ALTER TABLE vehiculo_accidente ADD CONSTRAINT VN_FACCIDENTE_VACCIDENTE CHECK (f_accidente>0);




				  *INVOLUCRADO_VEHICULO*

create table involucrado_vehiculo(
    id_involucrado int NOT NULL AUTO_INCREMENT,
    id_accidente int,
    id_vehiculo int,
    id_persona int,
    id_multa int,
    PRIMARY KEY (id_involucrado),
    FOREIGN KEY (id_accidente) REFERENCES vehiculo_accidente (id_accidente) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_vehiculo) REFERENCES vehiculo (id_vehiculo) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_multa) REFERENCES multa (id_multa) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_persona) REFERENCES persona_adicional (id_persona) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE involucrado_vehiculo ADD CONSTRAINT UQ_ID_INVOLUCRADO_INVEHICULO UNIQUE (id_involucrado);




				          *MULTA*

create table multa(
    id_multa int NOT NULL AUTO_INCREMENT,
    id_vehiculo int NOT NULL,
    id_cliente_conductor int NOT NULL,
    importe int NOT NULL,
    f_multa date NOT NULL,
    lugar varchar(50) NOT NULL,
    nivel_gravedad varchar(50) NOT NULL,
    PRIMARY KEY (id_multa),
    FOREIGN KEY (id_vehiculo) REFERENCES vehiculo (id_vehiculo) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_cliente_conductor) REFERENCES cliente (id_cliente) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE multa ADD CONSTRAINT UQ_ID_MULTA_MULTA UNIQUE (id_multa);
ALTER TABLE multa ADD CONSTRAINT VN_IMPORTE_MULTA CHECK (importe>0);
ALTER TABLE multa ADD CONSTRAINT VN_FMULTA_MULTA CHECK (f_multa>0);
ALTER TABLE multa ADD CONSTRAINT NIVEL_GRAVEDAD_MULTA CHECK (nivel_gravedad>='1' and nivel_gravedad<='10');




				          *POLIZA*

create table poliza(
    id_poliza int NOT NULL AUTO_INCREMENT,
    id_empleado int NOT NULL,
    nombre_tomador varchar(50) NOT NULL,
    cobertura double NOT NULL,
    forma_de_pago varchar(50) NOT NULL,
    f_contrato date NOT NULL,
    f_Renovacion varchar(50) NOT NULL,
    vigente varchar(50) NOT NULL,
    tipo varchar(50) NOT NULL,
    prima double NOT NULL,
    PRIMARY KEY (id_poliza),
    FOREIGN KEY (id_empleado) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE poliza ADD CONSTRAINT UQ_ID_POLIZA_POLIZA UNIQUE (id_poliza);
ALTER TABLE poliza ADD CONSTRAINT V_VIGENTE_POLIZA CHECK (vigente='Si' or 'No');
ALTER TABLE poliza ADD CONSTRAINT V_TIPO_POLIZA CHECK (tipo='Vehiculo' or tipo='Hogar' or tipo='Vida');
ALTER TABLE poliza ADD CONSTRAINT VN_COBERTURA_POLIZA CHECK (cobertura>0);
ALTER TABLE poliza ADD CONSTRAINT VN_FCONTRATO_POLIZA CHECK (f_contrato>0);
ALTER TABLE poliza ADD CONSTRAINT VN_FRENOVACION_POLIZA CHECK (f_renovacion>0);
ALTER TABLE poliza ADD CONSTRAINT VN_PRIMA_POLIZA CHECK (prima>0);




				     *POLIZA_HOGAR*

create table poliza_hogar(
    id int NOT NULL AUTO_INCREMENT,
    id_poliza int NOT NULL,
    nombre_item varchar(50) NOT NULL,
    tipo_item varchar(50) NOT NULL,
    valor_item double NOT NULL,
    prima_asignada double NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_poliza) REFERENCES poliza (id_poliza) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE poliza_hogar ADD CONSTRAINT UQ_ID_PHOGAR UNIQUE (id);
ALTER TABLE poliza_hogar ADD CONSTRAINT VN_VITEM_PHOGAR CHECK (valor_item>0);
ALTER TABLE poliza_hogar ADD CONSTRAINT VN_PRIMA_PHOGAR CHECK (prima_asignada>0);




				     *POLIZA_VIDA*

create table poliza_vida(
    id int NOT NULL AUTO_INCREMENT,
    id_poliza int NOT NULL,
    edad_cliente date NOT NULL,
    profesion_cliente varchar(50) NOT NULL,
    cobertura_economica double NOT NULL,
    prima_asignada double NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_poliza) REFERENCES poliza (id_poliza) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE poliza_vida ADD CONSTRAINT UQ_ID_PVIDA UNIQUE (id);
ALTER TABLE poliza_vida ADD CONSTRAINT VN_EDAD_CLIENTE_PVIDA CHECK (edad_cliente>0);
ALTER TABLE poliza_vida ADD CONSTRAINT VN_COBERTURAE_PVIDA CHECK (cobertura_economica>0);
ALTER TABLE poliza_vida ADD CONSTRAINT VN_PRIMA_PVIDA CHECK (prima_asignada>0);




				     *POLIZA_VEHICULO*

create table poliza_vehiculo(
    id int NOT NULL AUTO_INCREMENT,
    id_poliza int NOT NULL,
    categoria_vehiculo varchar(50) NOT NULL,
    edad_vehiculo int NOT NULL,
    edad_conductor date NOT NULL,
    tipo_cobertura varchar(50) NOT NULL,
    prima_asignada double NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (id_poliza) REFERENCES poliza (id_poliza) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE poliza_vehiculo ADD CONSTRAINT UQ_ID_PVEHICULO UNIQUE (id);
ALTER TABLE poliza_vehiculo ADD CONSTRAINT VN_EDADV_PVEHICULO CHECK (edad_vehiculo>0);
ALTER TABLE poliza_vehiculo ADD CONSTRAINT VN_EDADC_PVEHICULO CHECK (edad_conductor>0);
ALTER TABLE poliza_vehiculo ADD CONSTRAINT VN_PRIMA_PVEHICULO CHECK (prima_asignada>0);




				  *PROPIETARIO_POLIZA*

create table propietario_poliza(
    id_propietario int NOT NULL AUTO_INCREMENT,
    id_cliente int NOT NULL,
    id_poliza int NOT NULL,
    id_agente_personal int NOT NULL,
    f_ultimo_uso date NOT NULL,
    PRIMARY KEY (id_propietario),
    FOREIGN KEY (id_cliente) REFERENCES cliente (id_cliente) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_poliza) REFERENCES poliza (id_poliza) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_agente_personal) REFERENCES empleado (id_empleado) ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE propietario_poliza ADD CONSTRAINT UQ_ID_PROPIETARIO_PPOLIZA UNIQUE (id_propietario);
ALTER TABLE propietario_poliza ADD CONSTRAINT VN_FULT_USO_PPOLIZA CHECK (f_ultimo_uso>0);




				  *PERSONA_ADICIONAL*

create table persona_adicional(
    id_persona int NOT NULL AUTO_INCREMENT,
    nombre varchar(50) NOT NULL,
    apellido varchar(50) NOT NULL,
    cedula int NOT NULL,
    direccion varchar(50) NOT NULL,
    telefono int NOT NULL, 
    ciudad varchar(50) NOT NULL, 
    PRIMARY KEY (id_persona)
)

ALTER TABLE persona_adicional ADD CONSTRAINT NN_NOMBRE_PERSONAD CHECK (nombre<>' ');
ALTER TABLE persona_adicional ADD CONSTRAINT NN_APELLIDO_PERSONAD CHECK (apellido<>' ');
ALTER TABLE persona_adicional ADD CONSTRAINT VN_CEDULA_PERSONAD CHECK (cedula>0);
ALTER TABLE persona_adicional ADD CONSTRAINT VN_TELEFONO_PERSONAD CHECK (telefono>0);



		                *BENEFICIARIO_POLIZA*

create table beneficiario_poliza(
    id_beneficiario int NOT NULL AUTO_INCREMENT,
    id_persona_beneficiario int NOT NULL,
    id_poliza int NOT NULL,
    PRIMARY KEY (id_beneficiario),
    FOREIGN KEY (id_poliza) REFERENCES poliza (id_poliza) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (id_persona_beneficiario) REFERENCES persona_adicional (id_persona) ON DELETE CASCADE ON UPDATE CASCADE
)